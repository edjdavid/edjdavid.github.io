var idCtr=0,timer=null;function Path(a,b,c,d){this.elem=a;this.name=d;this.setId();this.addMarker();Path.paths[this.getElement().id]=this;this.startTime=b||0;this.simTime=c||3600/Path.config.simStep;this.pathLoc=0;this.animDone=null}Path.prototype.getElement=function(){return this.elem};Path.prototype.setId=function(){var a=idCtr;idCtr+=1;this.getElement().id="feature-"+a};Path.prototype.getSvg=function(){return this.getElement().parentNode.parentNode};
Path.prototype.getStartPoint=function(){var a=this.getElement().getPointAtLength(0);return a.x+","+a.y};Path.prototype.addMarker=function(){var a=d3.select(this.getElement()),b=d3.select(this.getSvg()),c=this.getStartPoint();b=b.append("circle");b.attr("r",2).attr("id","marker-"+a.attr("id")).attr("transform","translate("+c+")").attr("class","path-marker");this.marker=b};Path.prototype.removeMarker=function(){this.marker.remove()};Path.prototype.noop=function(){};Path.prototype.onAnimationStart=Path.prototype.noop;
Path.prototype.onAnimationEnd=Path.prototype.noop;
Path.prototype.animate=function(a){var b=a-this.startTime;if(!(0>b)){null===this.animDone&&(this.onAnimationStart(),this.animDone=!1);a=this.getElement();var c=a.getTotalLength();b=c/this.simTime*1*(b/Path.config.time);b>c?(this.onAnimationEnd(),this.animDone=!0,this.removeMarker(),this.pathLoc=1,d3.select(a).attr("stroke-opacity",.3).attr("stroke-dasharray",null)):d3.select(a).attr("stroke-opacity",.45).attr("stroke-dasharray",b+","+c);this.pathLoc=b/parseFloat(c);a=a.getPointAtLength(b);this.marker.attr("transform",
"translate("+a.x+","+a.y+")")}};Path.prototype.reposition=function(){var a=this.getElement(),b=a.getTotalLength(),c=b*this.pathLoc;isNaN(c)||0===c||(0<this.pathLoc&&!this.animDone&&d3.select(a).attr("stroke-dasharray",c+","+b),a=a.getPointAtLength(c),this.marker&&this.marker.attr("transform","translate("+a.x+","+a.y+")"))};Path.prototype.onZoomEnd=function(){this.reposition()};Path.animateAll=function(){timer=d3.timer(Path.config.timerCallback)};
Path.eachPath=function(a){for(var b in Path.paths)Path.paths.hasOwnProperty(b)&&a(Path.paths[b])};Path.paths={};
Path.config={time:100,simStep:60,startTime:(new Date).getTime(),runTime:1E4,endTIme:null,displayTime:function(a){a=new Date(a/Path.config.time*1E3*Path.config.simStep+Path.config.startTime);d3.select("#date").text([a.getFullYear(),("0"+(a.getMonth()+1)).slice(-2),("0"+a.getDate()).slice(-2)].join("/"));return a},animationEnd:Path.prototype.noop,timerCallback:function(a){Path.eachPath(function(b){b.animDone||b.animate(a)});var b=Path.config.displayTime(a);Path.config.animationEnd();b>Path.config.endTIme&&
timer.stop()}};function Point(a,b,c){this.elem=a;this.name=c;this.startTime=b;this.animDone=null;this.setId();Path.paths[this.getElement().id]=this}Point.prototype=Object.create(Path.prototype);Point.prototype.addMarker=Point.prototype.noop;Point.prototype.reposition=Point.prototype.noop;Point.prototype.animate=function(a){0>a-this.startTime||null!==this.animDone||(this.animDone=!0,this.onAnimationStart())};Point.prototype.onAnimationEnd=Point.prototype.noop;Point.prototype.noAnim=!0;
