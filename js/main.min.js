queue().defer(d3.json,"files/map.geojson").await(ready);
function loadGeoJson(d){var a=L.map("map",{center:[14.654895,121.065019],zoom:14});L.tileLayer("http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",{attribution:'<a href="https://github.com/edjdavid">edjdavid</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:15}).addTo(a);L.geoJson(d,{pointToLayer:function(c,b){return L.marker(b,{title:c.properties.name})},color:"#ff7800",weight:4,
opacity:0}).addTo(a).eachLayer(function(c){var b=c.feature.properties.name,a=((new Date(c.feature.properties.startTime)).getTime()-Path.config.startTime)/Path.config.simStep*Path.config.time/1E3;if("LineString"!==c.feature.geometry.type)new Point(c.getElement(),a,b);else{var f=c.feature.properties.duration/Path.config.simStep;new Path(c.getElement(),a,f,b)}});a.on("moveend",function(){Path.eachPath(function(c){c.onZoomEnd()})});return a}
function ready(d,a){d&&console.log(d);Path.config.startTime=(new Date("2009-01-01T00:00:00")).getTime();Path.config.simStep=2419200;Path.config.endTIme=new Date("2020-01-01T00:00:00");Path.prototype.onAnimationStart=function(){d3.select("#message").text(this.name);if(!this.animDone){var c=map.layerPointToLatLng(this.getElement().getPointAtLength(0));L.marker(c,{title:this.name,riseOnHover:!0}).addTo(map)}};Path.prototype.onAnimationEnd=function(){d3.select("#message").text("")};window.map=loadGeoJson(a);
var c=[],b;for(b in Path.paths)Path.paths.hasOwnProperty(b)&&c.push(b);var e=0;Path.config.animationEnd=function(){var a=Path.paths[c[e]];if(a&&!a.noAnim){var b=a.getElement(),d=b.getTotalLength();0!==d&&(b=b.getPointAtLength(d*a.pathLoc),b=map.layerPointToLatLng(L.point(b.x,b.y)),map.panTo(b))}a&&a.animDone&&(e+=1)};Path.animateAll()};
